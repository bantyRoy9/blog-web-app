{"ast":null,"code":"\"use strict\";\n\nvar _Object$keys2 = require(\"@babel/runtime-corejs3/core-js-stable/object/keys\");\n\nvar _Object$getOwnPropertySymbols = require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols\");\n\nvar _filterInstanceProperty2 = require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\");\n\nvar _Object$getOwnPropertyDescriptor = require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor\");\n\nvar _forEachInstanceProperty2 = require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\");\n\nvar _Object$getOwnPropertyDescriptors = require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors\");\n\nvar _Object$defineProperties = require(\"@babel/runtime-corejs3/core-js-stable/object/define-properties\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.parseIdxResponse = exports.parseNonRemediations = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/slicedToArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/defineProperty\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/objectWithoutProperties\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/typeof\"));\n\nvar _fromEntries = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/from-entries\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _forEach = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _entries = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/entries\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _remediationParser = require(\"./remediationParser\");\n\nvar _generateIdxAction = _interopRequireDefault(require(\"./generateIdxAction\"));\n\nvar _jsonpathPlus = require(\"jsonpath-plus\");\n\nvar _context;\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = _Object$keys2(object);\n\n  if (_Object$getOwnPropertySymbols) {\n    var symbols = _Object$getOwnPropertySymbols(object);\n\n    if (enumerableOnly) symbols = _filterInstanceProperty2(symbols).call(symbols, function (sym) {\n      return _Object$getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      var _context8;\n\n      _forEachInstanceProperty2(_context8 = ownKeys(Object(source), true)).call(_context8, function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (_Object$getOwnPropertyDescriptors) {\n      _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source));\n    } else {\n      var _context9;\n\n      _forEachInstanceProperty2(_context9 = ownKeys(Object(source))).call(_context9, function (key) {\n        _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar SKIP_FIELDS = (0, _fromEntries.default)((0, _map.default)(_context = ['remediation', // remediations are put into proceed/neededToProceed\n'context' // the API response of 'context' isn't externally useful.  We ignore it and put all non-action (contextual) info into idxState.context\n]).call(_context, function (field) {\n  return [field, !!'skip this field'];\n}));\n\nvar parseNonRemediations = function parseNonRemediations(idxResponse) {\n  var _context2, _context3;\n\n  var toPersist = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var actions = {};\n  var context = {};\n  (0, _forEach.default)(_context2 = (0, _filter.default)(_context3 = (0, _keys.default)(idxResponse)).call(_context3, function (field) {\n    return !SKIP_FIELDS[field];\n  })).call(_context2, function (field) {\n    var _context4;\n\n    var fieldIsObject = (0, _typeof2.default)(idxResponse[field]) === 'object' && !!idxResponse[field];\n\n    if (!fieldIsObject) {\n      // simple fields are contextual info\n      context[field] = idxResponse[field];\n      return;\n    }\n\n    if (idxResponse[field].rel) {\n      // top level actions\n      actions[idxResponse[field].name] = (0, _generateIdxAction.default)(idxResponse[field], toPersist);\n      return;\n    }\n\n    var _idxResponse$field = idxResponse[field],\n        fieldValue = _idxResponse$field.value,\n        type = _idxResponse$field.type,\n        info = (0, _objectWithoutProperties2.default)(_idxResponse$field, [\"value\", \"type\"]);\n    context[field] = _objectSpread({\n      type: type\n    }, info); // add the non-action parts as context\n\n    if (type !== 'object') {\n      // only object values hold actions\n      context[field].value = fieldValue;\n      return;\n    } // We are an object field containing an object value\n\n\n    context[field].value = {};\n    (0, _forEach.default)(_context4 = (0, _entries.default)(fieldValue)).call(_context4, function (_ref) {\n      var _ref2 = (0, _slicedToArray2.default)(_ref, 2),\n          subField = _ref2[0],\n          value = _ref2[1];\n\n      if (value.rel) {\n        var _context5; // is [field].value[subField] an action?\n        // add any \"action\" value subfields to actions\n\n\n        actions[(0, _concat.default)(_context5 = \"\".concat(field, \"-\")).call(_context5, subField.name || subField)] = (0, _generateIdxAction.default)(value, toPersist);\n      } else {\n        // add non-action value subfields to context\n        context[field].value[subField] = value;\n      }\n    });\n  });\n  return {\n    context: context,\n    actions: actions\n  };\n};\n\nexports.parseNonRemediations = parseNonRemediations;\n\nvar expandRelatesTo = function expandRelatesTo(idxResponse, value) {\n  var _context6;\n\n  (0, _forEach.default)(_context6 = (0, _keys.default)(value)).call(_context6, function (k) {\n    if (k === 'relatesTo') {\n      var query = (0, _isArray.default)(value[k]) ? value[k][0] : value[k];\n\n      if (typeof query === 'string') {\n        // eslint-disable-next-line new-cap\n        var result = (0, _jsonpathPlus.JSONPath)({\n          path: query,\n          json: idxResponse\n        })[0];\n\n        if (result) {\n          value[k] = result;\n          return;\n        }\n      }\n    }\n\n    if ((0, _isArray.default)(value[k])) {\n      var _context7;\n\n      (0, _forEach.default)(_context7 = value[k]).call(_context7, function (innerValue) {\n        return expandRelatesTo(idxResponse, innerValue);\n      });\n    }\n  });\n};\n\nvar convertRemediationAction = function convertRemediationAction(remediation, toPersist) {\n  var remediationActions = (0, _remediationParser.generateRemediationFunctions)([remediation], toPersist);\n  var actionFn = remediationActions[remediation.name];\n  return _objectSpread(_objectSpread({}, remediation), {}, {\n    action: actionFn\n  });\n};\n\nvar parseIdxResponse = function parseIdxResponse(idxResponse) {\n  var _idxResponse$remediat;\n\n  var toPersist = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var remediationData = ((_idxResponse$remediat = idxResponse.remediation) === null || _idxResponse$remediat === void 0 ? void 0 : _idxResponse$remediat.value) || [];\n  (0, _forEach.default)(remediationData).call(remediationData, function (remediation) {\n    return expandRelatesTo(idxResponse, remediation);\n  });\n  var remediations = (0, _map.default)(remediationData).call(remediationData, function (remediation) {\n    return convertRemediationAction(remediation, toPersist);\n  });\n\n  var _parseNonRemediations = parseNonRemediations(idxResponse, toPersist),\n      context = _parseNonRemediations.context,\n      actions = _parseNonRemediations.actions;\n\n  return {\n    remediations: remediations,\n    context: context,\n    actions: actions\n  };\n};\n\nexports.parseIdxResponse = parseIdxResponse;","map":{"version":3,"sources":["D:/project/blog-web-app/blog-web-app/client/node_modules/@okta/okta-idx-js/src/v1/idxResponseParser.js"],"names":["_Object$keys2","require","_Object$getOwnPropertySymbols","_filterInstanceProperty2","_Object$getOwnPropertyDescriptor","_forEachInstanceProperty2","_Object$getOwnPropertyDescriptors","_Object$defineProperties","_Object$defineProperty","_interopRequireDefault","exports","value","parseIdxResponse","parseNonRemediations","_slicedToArray2","_defineProperty2","_objectWithoutProperties2","_typeof2","_fromEntries","_map","_forEach","_filter","_keys","_entries","_concat","_isArray","_remediationParser","_generateIdxAction","_jsonpathPlus","_context","ownKeys","object","enumerableOnly","keys","symbols","call","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","_context8","Object","key","default","_context9","SKIP_FIELDS","field","idxResponse","_context2","_context3","toPersist","undefined","actions","context","_context4","fieldIsObject","rel","name","_idxResponse$field","fieldValue","type","info","_ref","_ref2","subField","_context5","concat","expandRelatesTo","_context6","k","query","result","JSONPath","path","json","_context7","innerValue","convertRemediationAction","remediation","remediationActions","generateRemediationFunctions","actionFn","action","_idxResponse$remediat","remediationData","remediations","_parseNonRemediations"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _Object$keys2 = require(\"@babel/runtime-corejs3/core-js-stable/object/keys\");\n\nvar _Object$getOwnPropertySymbols = require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols\");\n\nvar _filterInstanceProperty2 = require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\");\n\nvar _Object$getOwnPropertyDescriptor = require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor\");\n\nvar _forEachInstanceProperty2 = require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\");\n\nvar _Object$getOwnPropertyDescriptors = require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors\");\n\nvar _Object$defineProperties = require(\"@babel/runtime-corejs3/core-js-stable/object/define-properties\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.parseIdxResponse = exports.parseNonRemediations = void 0;\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/slicedToArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/defineProperty\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/objectWithoutProperties\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/typeof\"));\n\nvar _fromEntries = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/from-entries\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _forEach = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _entries = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/entries\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _remediationParser = require(\"./remediationParser\");\n\nvar _generateIdxAction = _interopRequireDefault(require(\"./generateIdxAction\"));\n\nvar _jsonpathPlus = require(\"jsonpath-plus\");\n\nvar _context;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys2(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty2(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context8; _forEachInstanceProperty2(_context8 = ownKeys(Object(source), true)).call(_context8, function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context9; _forEachInstanceProperty2(_context9 = ownKeys(Object(source))).call(_context9, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar SKIP_FIELDS = (0, _fromEntries.default)((0, _map.default)(_context = ['remediation', // remediations are put into proceed/neededToProceed\n'context' // the API response of 'context' isn't externally useful.  We ignore it and put all non-action (contextual) info into idxState.context\n]).call(_context, function (field) {\n  return [field, !!'skip this field'];\n}));\n\nvar parseNonRemediations = function parseNonRemediations(idxResponse) {\n  var _context2, _context3;\n\n  var toPersist = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var actions = {};\n  var context = {};\n  (0, _forEach.default)(_context2 = (0, _filter.default)(_context3 = (0, _keys.default)(idxResponse)).call(_context3, function (field) {\n    return !SKIP_FIELDS[field];\n  })).call(_context2, function (field) {\n    var _context4;\n\n    var fieldIsObject = (0, _typeof2.default)(idxResponse[field]) === 'object' && !!idxResponse[field];\n\n    if (!fieldIsObject) {\n      // simple fields are contextual info\n      context[field] = idxResponse[field];\n      return;\n    }\n\n    if (idxResponse[field].rel) {\n      // top level actions\n      actions[idxResponse[field].name] = (0, _generateIdxAction.default)(idxResponse[field], toPersist);\n      return;\n    }\n\n    var _idxResponse$field = idxResponse[field],\n        fieldValue = _idxResponse$field.value,\n        type = _idxResponse$field.type,\n        info = (0, _objectWithoutProperties2.default)(_idxResponse$field, [\"value\", \"type\"]);\n    context[field] = _objectSpread({\n      type: type\n    }, info); // add the non-action parts as context\n\n    if (type !== 'object') {\n      // only object values hold actions\n      context[field].value = fieldValue;\n      return;\n    } // We are an object field containing an object value\n\n\n    context[field].value = {};\n    (0, _forEach.default)(_context4 = (0, _entries.default)(fieldValue)).call(_context4, function (_ref) {\n      var _ref2 = (0, _slicedToArray2.default)(_ref, 2),\n          subField = _ref2[0],\n          value = _ref2[1];\n\n      if (value.rel) {\n        var _context5;\n\n        // is [field].value[subField] an action?\n        // add any \"action\" value subfields to actions\n        actions[(0, _concat.default)(_context5 = \"\".concat(field, \"-\")).call(_context5, subField.name || subField)] = (0, _generateIdxAction.default)(value, toPersist);\n      } else {\n        // add non-action value subfields to context\n        context[field].value[subField] = value;\n      }\n    });\n  });\n  return {\n    context: context,\n    actions: actions\n  };\n};\n\nexports.parseNonRemediations = parseNonRemediations;\n\nvar expandRelatesTo = function expandRelatesTo(idxResponse, value) {\n  var _context6;\n\n  (0, _forEach.default)(_context6 = (0, _keys.default)(value)).call(_context6, function (k) {\n    if (k === 'relatesTo') {\n      var query = (0, _isArray.default)(value[k]) ? value[k][0] : value[k];\n\n      if (typeof query === 'string') {\n        // eslint-disable-next-line new-cap\n        var result = (0, _jsonpathPlus.JSONPath)({\n          path: query,\n          json: idxResponse\n        })[0];\n\n        if (result) {\n          value[k] = result;\n          return;\n        }\n      }\n    }\n\n    if ((0, _isArray.default)(value[k])) {\n      var _context7;\n\n      (0, _forEach.default)(_context7 = value[k]).call(_context7, function (innerValue) {\n        return expandRelatesTo(idxResponse, innerValue);\n      });\n    }\n  });\n};\n\nvar convertRemediationAction = function convertRemediationAction(remediation, toPersist) {\n  var remediationActions = (0, _remediationParser.generateRemediationFunctions)([remediation], toPersist);\n  var actionFn = remediationActions[remediation.name];\n  return _objectSpread(_objectSpread({}, remediation), {}, {\n    action: actionFn\n  });\n};\n\nvar parseIdxResponse = function parseIdxResponse(idxResponse) {\n  var _idxResponse$remediat;\n\n  var toPersist = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var remediationData = ((_idxResponse$remediat = idxResponse.remediation) === null || _idxResponse$remediat === void 0 ? void 0 : _idxResponse$remediat.value) || [];\n  (0, _forEach.default)(remediationData).call(remediationData, function (remediation) {\n    return expandRelatesTo(idxResponse, remediation);\n  });\n  var remediations = (0, _map.default)(remediationData).call(remediationData, function (remediation) {\n    return convertRemediationAction(remediation, toPersist);\n  });\n\n  var _parseNonRemediations = parseNonRemediations(idxResponse, toPersist),\n      context = _parseNonRemediations.context,\n      actions = _parseNonRemediations.actions;\n\n  return {\n    remediations: remediations,\n    context: context,\n    actions: actions\n  };\n};\n\nexports.parseIdxResponse = parseIdxResponse;"]},"metadata":{},"sourceType":"script"}